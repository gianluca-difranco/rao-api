openapi: 3.0.1
info:
  title: ID Professionali
  description: Chiamate API per l'interazione tra portale e Sielte.
  version: 1.0.0
tags:
- name: Authentication
  description: Api relative all'accesso di un'utenza
- name: UserManagement
  description: API per la gestione delle utenze
- name: IdentityManagement
  description: API per la gestione delle identità
paths:
  /login:
    post:
      tags:
      - Authentication
      summary: Login tramite SielteID
      operationId: auth
      requestBody:
        description:
          La funzione prende in input il codice fiscale e la password dell'operatore che sta effettuando l'accesso. <br>
          Output CASO OK - Token di sessione. <br>
          Output CASO KO - messaggio relativo all'errore riscontrato.
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Auth'
        required: true
      responses:
        200:
          description: Operazione eseguita con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiAuthResponse200'
        400:
          description: Formato richiesta errato
        403:
          description: l'utente è disabilitato. Non può accedere
          
        404:
          description: Username o Password errati
        405:
          description: Formato dei parametri non corretto
      x-codegen-request-body-name: payload
  /otp:
    post:
      tags:
      - Authentication
      summary: inserimento OTP per verifica
      requestBody:
        description:
          La funzione prende in input il Token di sessione e l'OTP.
        content:
          multipart/form-data:
            schema:
              required:
              - sessionToken
              - otp
              type: object
              properties:
                sessionToken:
                  type: string
                  example: eyJ1c2VybmFtZSI6IkNpYW8ifQ:1lWcPE:a-vukHyF6j_sAxiHWSJ78wjeEqw
                otp:
                  type: integer
                  example: 345612
        required: true
      responses:
        200:
          description: Operazione eseguita con successo
          content:
            application/json:
              schema:
                properties:
                  role:
                    type: string
                    example: management
                  validatedSessionToken:
                    type: string
                    example: eyJ1c2VybmFtZSI6IkNpYW8ifQ:1lWcPE:a-vukHyF6j_sAxiHWSJ78wjeEqw
        400:
          description: Formato richiesta errato
        440:
          description: Sessione scaduta. Richiedi un nuovo codice OTP.
        405:
          description: Codice OTP errato
  
  /userList/{agencyId}:
    get:
      tags:
        - UserManagement
      summary: inserimento OTP per verifica
      description:
          Dato in input l'id dell'agenzia, l'API restituisce l'elenco delle utenze di gestione.
      parameters:
      - name: agencyId
        in: path
        description: id dell'agenzia
        required: true
        schema:
          type: integer
      responses:
        200:
          description: Operazione eseguita con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userList'
        400:
          description: Formato richiesta errato
        401:
          description: Non autorizzato
        404:
          description: Azienda non trovata
        
          
  /revokeUser:
    post:
      tags:
        - UserManagement
      summary: revoca utenza di gestione
      requestBody:
        description:
          La funzione prende in input il CF dell'operatore e l'azienda, restituendo uno status code.
        content:
          multipart/form-data:
            schema:
              properties:
                agencyId:
                  type: integer
                  example: 2
                userFiscalCode:
                  type: string
                  example: DFRGLC93E07C350A
        required: true
      responses:
        200:
          description: Operazione eseguita con successo
        400:
          description: Formato richiesta errato
        401:
          description: Non autorizzato
        404:
          description: Utente non trovato
          
  
  /identityList/{agencyId}:
    get:
      tags:
        - IdentityManagement
      summary: inserimento OTP per verifica
      description:
          Dato in input l'id dell'agenzia, l'API restituisce l'elenco delle identità.
      parameters:
      - name: agencyId
        in: path
        description: id dell'agenzia
        required: true
        schema:
          type: integer
      responses:
        200:
          description: Operazione eseguita con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/identityList' 
        400:
          description: Formato richiesta errato
        401:
          description: Non autorizzato
        404:
          description: Azienda non trovata
  /revokeIdentity:
    post:
      tags:
        - IdentityManagement
      summary: revoca identità
      requestBody:
        description:
          La funzione prende in input il CF relativa all'identità e l'azienda, restituendo uno status code.
        content:
          multipart/form-data:
            schema:
              properties:
                agencyId:
                  type: integer
                  example: 2
                userFiscalCode:
                  type: string
                  example: DFRGLC93E07C350A
        required: true
      responses:
        200:
          description: Operazione eseguita con successo
        400:
          description: Formato richiesta errato
        401:
          description: Non autorizzato
        404:
          description: identità non trovata
  /identityToken:
    post:
      tags:
        - IdentityManagement
      summary: Invia il token di autorizzazione per la creazione dell'identità.
      requestBody:
        description:
          La funzione prende in input il token di autorizzazione relativo all'identità e l'azienda, restituendo uno status code.
        content:
          multipart/form-data:
            schema:
              properties:
                agencyId:
                  type: integer
                  example: 2
                authToken:
                  type: string
                  example: 829cc13fc8e7ca9ab10e3206e56c9cb4fca993c0df73ae18214fe886ba0944b5
        required: true
      responses:
        200:
          description: Operazione eseguita con successo
components:
  schemas:
    Auth:
      required:
      - password
      - username
      type: object
      properties:
        username:
          type: string
          example: RSSMRA80A01C351O
        password:
          type: string
          example: LaMiaPass123!
    ApiAuthResponse200:
      type: string
      example: eyJ1c2VybmFtZSI6IkNpYW8ifQ:1lWcPE:a-vukHyF6j_sAxiHWSJ78wjeEqw
    ApiAuthResponse405:
      type: string
      example: Il formato del campo username non è corretto
    ApiAuthResponse403:
      type: string
      example: Credenziali bloccate.
    ApiAuthResponse404:
      type: string
      example: Non trovato
    userList:
      properties:
        users:
          type: array
          example: [{'name':Mario, 'surname':Rossi, 'role': management, "..": ".."},
                    {'name':Andrea, 'surname':Bianchi, 'role': management, "..": ".."}]
    identityList:
      properties:
        users:
          type: array
          example: [{'name':Mario, 'surname':Rossi, 'fiscalNumber': RSSFLV95C12H118C, "..": ".."},
                    {'name':Andrea, 'surname':Bianchi, 'fiscalNumber': RSSFLV95C12H11UZ, "..": ".."}]
    
